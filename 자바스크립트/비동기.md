# ***비동기***

## 1. 동기 처리와 비동기 처리
### 1-1. 함수 호출 과정
1. 함수를 호출하면 함수 코드가 평가되어 함수 실행 컨텍스트가 생성된다
2. 함수 실행 컨택스트는 실행 컨텍스트 스텍(=콜 스택)에 푸시되고 함수 코드가 실행
3. 함수 코드 실행이 종료되면 함수 실행 컨택스트는 실행 컨택스트 스택에서 팝되어 제거

### 1-2. 자바스크립트 엔진
- 자바스크립트 엔진은 단 하나의 실행 컨택스트 스택을 갖는다.
- 따라서 동시에 2개 이상의 함수를 동시에 실행할 수 없다는 것을 의미
- 이렇게 JS 엔진은 한 번에 하나의 테스크만 실행할 수 있는 싱글 스레드 방식으로 동작
- 싱글 스레드 방식은 한번에 하나의 태스크만 실행할 수 있기 때문에 처리에 시간이 걸리는 테스크를 실행하는 경우 블로킹(작업 중단)이 발생

### 1-3. 동기 처리와 비동기 처리
- 동기 처리는 현재 실행 중인 테스크가 종료될 때까지 다음에 실행될 테스크가 대기하는 방식
  - 실행 순서가 보장된다는 장점
  - 블로킹이 될 수 있다는 단점
- 비동기 처리는 현재 실행 중인 테스크가 종료되지 않은 상태라 해도 다음 테스크를 곧바로 실행하는 방식
  - 블로킹이 발생하지 않는다는 장점
  - 실행 순서가 보장되지 않는다는 단점
- 타이머 함수인 setTimeout, setInterval, HTTP 요청, 이벤트 핸들러는 비동기 처리 방식으로 동작

## 2. 이벤트 루프와 테스크 큐
### 2-1. 자바스크립트 엔진과 브라우저(Node.js)
- 자바스크립트의 동시성을 지원하는 것이 바로 이벤트 루프
- 이벤트 루프는 브라우저에 내장되어 있는 기능 중 하나
- V8엔진을 예로 들면 콜스택과 힙으로 구성 되어 있고 콜스택은 실행 컨텍스트가 추가되고 제거되는 자료구며 힙은 객체가 저장되는 메모리 공간
- v8 엔진은 단순히 태스크가 요청되면 콜 스택을 통해 요청된 작업을 순차적으로 실행하며, 비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 자바스크립트 엔진을 구동하는 환경인 브라우저 또는 Node.js가 담당
- 이 때, 브라우저 환경은 테스크 큐와 이벤트 루프를 제공

### 2-2. 테스크 큐
- 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
- 테스크 큐와는 별도로 프로미스의 후속 처리 메서드의 콜백 함수가 일시적으로 보관되는 마이크로 테스크 큐도 존재

### 2-3. 이벤트 루프
- 콜 스택에 현재 실행 중인 실행 컨텍스트가 있는지, 그리고 테스크 큐에 대기 중인 함수(콜백 함수, 이벤트 핸들러 등)이 있는지 반복하여 확인
- 만약 콜 스택이 비어 있고(전역까지) 테스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적으로 테스크 큐에 대기 중인 함수를 콜 스택으로 이동시킨다.
- 즉, 테스크 큐에 일시 보관된 함수들은 비동기 처리 방식으로 동작한다.
 > 브라우저에서 지연 시간이 4ms이하인 경우 최소 지연 시간 4ms가 저장된다
 > 또한 브라우저는 멀티 쓰레드이고 자바스크립트엔진이 싱글 스레드로 동작한다는 것을 알아 두어야함
 > 브라우저는 자바스크립트 엔진 외에도 렌더링 엔진과 Web API를 제공


## 3. 프로미스의 생성
- Promise 생성자 함수와 new 연산자를 함께 호출하면 프로미스(객체) 생성
- 프로미스 생성자 함수는 비동기 처리를 수행할 콜백 함수를 인수로 전달받는데 이 콜백함수는 resolve와 reject함수를 인수로 전달받는다.
  - 비동기 처리가 성공하면 resolve 함수 호출, 실패하면 reject함수 호출